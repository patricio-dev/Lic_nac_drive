name: Bot Licitaciones Paralelo

on:
  workflow_dispatch: # Bot칩n manual
  schedule:
    # Se ejecuta autom치ticamente cada 6 horas (00, 06, 12, 18 UTC)
    - cron: '0 */6 * * *'

jobs:
  procesar-licitaciones:
    name: Bot Clon ${{ matrix.lote }}
    runs-on: ubuntu-latest
    timeout-minutes: 350 # L칤mite de seguridad (casi 6 horas)

    strategy:
      fail-fast: false # Si el Clon 1 falla, el 2, 3 y 4 siguen trabajando
      matrix:
        # Lanzamos 4 m치quinas virtuales simult치neas
        lote: [1, 2, 3, 4]

    steps:
      # 1. Descargar tu c칩digo
      - name: 游닌 Descargar c칩digo
        uses: actions/checkout@v4

      # 2. Instalar Python 3.12
      - name: 游냀 Instalar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      # 3. Instalar librer칤as
      - name: 游닍 Instalar dependencias
        run: |
          pip install -r requirements.txt

      # 4. Ejecutar el Bot (YA NO CREAMOS EL ARCHIVO JSON)
      # Pasamos los secretos directamente a la memoria del proceso
      - name: 游 Ejecutar Bot
        env:
          GCP_CREDENTIALS: ${{ secrets.GCP_CREDENTIALS }}
          SHEET_ID: ${{ secrets.SHEET_ID }}
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}
        run: |
          # Ejecutamos el script indicando qu칠 n칰mero de lote es este clon
          python main.py --lote ${{ matrix.lote }} --total_lotes 4
